# 동물 추측 게임 버전2: C 프로그램

브라우저는 고수준 가상 머신이다. C언어로 프로그램을 작성하면서, 브라우저가 숨겨주는 운영체제의 기초적인 동작을 알아본다.(유닉스에서 파생된 운영체제이다.)

### 터미널과 명령줄

- 그래픽 사용자 인터페이스(GUI)
  - GUI는 주로 제스처 언어를 사용한다.
- 명령줄 인터페이스 (CUI)
  - 터미널 애플리케이션을 통해 명령 프롬프트를 확인할 수 있다.

### 프로그램 빌드

- C는 컴파일 언어이므로 소스 코드를 기계어로 변환해야 한다.
- 이 변환 과정을 `빌드`라고 한다.

```bash
cc gta.c -o gta
```

- `cc`: C 컴파일러
- `gta.c`: 소스 파일 이름
- `-o`: 출력 파일 이름이 -o 다음에 온다.
- `gta`: 출력 파일 이름

### 터미널과 장치 드라이버

- 사용자 프로그램은 직접 `I/O 장치`와 통신하지 않고, `운영체제`가 통신을 중재한다.
- 터미널 소프트웨어가 I/O장치와 통신하는 과정은 다음 그림과 같다.
  ![그림 10-6](https://cdn.discordapp.com/attachments/879215554379018243/1010602485863432222/unknown.png)
- 이전에는 터미널을 컴퓨터와 직렬 연결하는 물리적인 선이 존재했다.
- 오늘날 운영 체제는 이런 연결이 진짜 존재하는 것처럼 소프트웨어로 흉내내어 동작한다.

### 문맥 전환 (Context switching)

- 레지스터 집합은 컴퓨터에서 하나 뿐이다. 운영체제는 한 사용자의 프로그램을 다른 사용자 프로그램으로 바꿀 때마다 레지스터를 저장하고 복구해야한다.
- 저장하고 복구해야 하는 모든 내용을 `프로세스 문맥 (process context)` 이라고 한다.
- 문맥의 크기가 커서 문맥 전환의 비용이 비싸기 때문에 `시스템 콜`은 아래와 같이 이루어진다.
  ![그림 10-7 문맥 전환](https://media.discordapp.net/attachments/879215554379018243/1010602340258152538/unknown.png)

- 물리적 장치와 관련된 처리를 담당하는 `장치 드라이버`는 터미널에 들어오는 문자를 `버퍼`에 저장하고, 사용자가 키를 누를 때가 아닌, Enter를 누를 때만 사용자 프로그램을 깨운다.

#### 버퍼

- 선입선출(FIFO) 데이터 구조
- 사용자의 키 입력은 프로그램이 디스플레이에 보내는 출력보다 느리기 때문에 `입력 버퍼`와 `출력 버퍼`가 필요하다.
- 출력 버퍼가 다 차도 프로그램이 터미널에 출력을 시도하면 프로그램을 슬립 상태로 전환한다.

![그림 10-9 터미널 장치 드라이버의 버퍼링과 메아리](https://media.discordapp.net/attachments/879215554379018243/1010601902297337866/unknown.png)

### 표준 I/O

표준 입력/출력 라이브러리 (standard input/ouput, stdio) 에는 사용자 프로그램이 사용할 수 있는 버퍼 I/O 함수가 들어있다.
![그림 10-10 stdio 버퍼를 사용하는 사용자 프로그램](https://cdn.discordapp.com/attachments/879215554379018243/1010601598151557160/unknown.png)

- 버퍼 입력을 지원하여 시스템 콜을 한 번만 사용해 데이터를 `버퍼`에 넣는다.
- 사용자 프로그램은 버퍼가 빌 때까지 버퍼에 `입력 문자`를 얻는다.
- 버퍼가 소진되면 다시 시스템 콜을 통해 입력을 더 가져온다.
- 출력하는 경우 버퍼가 꽉 차거나 중요한 문자가 출력될 때까지 문자가 버퍼에 들어간다.

이렇게 입출력을 효율적으로 하기 위해 많은 일을 한다.

### 원형 버퍼

![그림 10-14 원형 버퍼](https://cdn.discordapp.com/attachments/879215554379018243/1010601789055311965/unknown.png)

- in과 out은 원소를 가리키는 포인터이다.
- in 화살표가 시계방향으로 out 화살표를 따라잡기 전까지는 큐에 원소를 추가할 수 있다.
- out 화살표가 시계방향으로 in 화살표를 따라잡기 전까지는 큐에 원소를 제거할 수 있다.
- 화살표의 다음 위치는 현재 위치에 1을 더한다음 버퍼 크기로 나눈 나머지이다.
- stdio나 장치 드라이버 그 외에도 표준적으로 많이 쓰이는 방식이다.
